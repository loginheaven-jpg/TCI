# TCI 그룹 분석 서비스 - 최종 작업요청서

> **작성일**: 2026-01-06  
> **버전**: 3.0 (Phase 분리)  
> **핵심 원칙**: 기존 UI 유지 + 점진적 기능 추가

---

# 📌 전체 개요

## 현재 상황
- `tci_app_phase1_final.jsx` = 검증 완료된 프로토타입 (UI/UX 확정)
- Claude Code가 전체 재설계하여 원본 UI 손실
- **복구 필요**: Phase 1 코드를 베이스로 복원

## 작업 구조
```
┌─────────────────────────────────────────────────────┐
│  1차 작업: UI 복원 + 개인리포트 강화                  │
│  - tci_app_phase1_final.jsx 복원                    │
│  - 개인리포트에 해석 섹션 추가                       │
│  - LocalStorage 유지                                │
│  - 예상 소요: 2~3일                                 │
└─────────────────────────────────────────────────────┘
                        ↓
                   검증 완료 후
                        ↓
┌─────────────────────────────────────────────────────┐
│  2차 작업: Supabase 연동                            │
│  - UI 변경 없이 저장소만 교체                        │
│  - 로그인/회원가입 추가                             │
│  - 예상 소요: 3~5일                                 │
└─────────────────────────────────────────────────────┘
```

---

# 🔷 1차 작업: UI 복원 + 개인리포트 강화

## 목표
Phase 1 프로토타입의 UI/UX를 그대로 유지하면서, **개인 리포트 섹션에만** 심층 해석 기능을 추가한다.

---

## ⚠️ 핵심 규칙

### 절대 금지
| 항목 | 이유 |
|------|------|
| ❌ Supabase 사용 | 2차 작업으로 분리 |
| ❌ 로그인/회원가입 | 2차 작업으로 분리 |
| ❌ 그룹 분석 UI 변경 | 검증된 UI 유지 |
| ❌ 파일 구조 복잡화 | 단순 구조 유지 |
| ❌ 새로운 라우팅 | 기존 상태 기반 네비게이션 유지 |

### 반드시 준수
| 항목 | 상세 |
|------|------|
| ✅ `tci_app_phase1_final.jsx` 복원 | 이 파일이 App.jsx의 베이스 |
| ✅ LocalStorage 사용 | 그룹 데이터 저장/불러오기 |
| ✅ 개인리포트에만 추가 | 다른 화면은 변경 없음 |
| ✅ 기존 Tailwind 스타일 유지 | 그라데이션, 컬러섀도우, 라운드 |

---

## 파일 구조 (1차 작업)

```
src/
├── App.jsx              # tci_app_phase1_final.jsx 내용 복원 + 개인리포트 확장
├── main.jsx             # 엔트리포인트 (변경 없음)
├── index.css            # 스타일 (변경 없음)
└── data/
    └── interpretations.js   # tci_interpretations.js 복사
```

> ⚠️ `hooks/`, `components/`, `lib/` 등 폴더 분리 **하지 않음**

---

## 의존성 (package.json)

```json
{
  "name": "tci-group-analysis",
  "version": "1.5.0",
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "recharts": "^2.10.0",
    "papaparse": "^5.4.1",
    "html2pdf.js": "^0.10.1"
  }
}
```

> ⚠️ `@supabase/supabase-js` **포함하지 않음**

---

## 유지해야 할 기존 화면

### 1. 메인 화면 (그룹 목록)
```
┌─────────────────────────────────────────┐
│ TCI 그룹 분석                           │
│ 기질 및 성격검사 분석 서비스              │
├─────────────────────────────────────────┤
│ [+ 새 그룹 만들기]                       │
│                                         │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│ │ 그룹1   │ │ 그룹2   │ │ 그룹3   │    │
│ │ 10명    │ │ 8명     │ │ 12명    │    │
│ └─────────┘ └─────────┘ └─────────┘    │
└─────────────────────────────────────────┘
```
**→ 변경 없음**

### 2. 그룹 분석 화면
```
┌─────────────────────────────────────────┐
│ ← 26년 TCI 기초#1  [멤버선택][PDF][CSV] │
├─────────────────────────────────────────┤
│ ◉ 기질 분석  ○ 성격 분석  ○ 멤버 관리  │
├─────────────────────────────────────────┤
│ [레이더] [막대] [상세]                   │
├───────────────────────┬─────────────────┤
│                       │ 기질 유형 분포   │
│   레이더 차트          │ MLM 2명 (20%)   │
│   (10명 오버레이)      │ HMH 2명 (20%)   │
│                       │ ...             │
│   ● 박영의 ● 김순희   ├─────────────────┤
│   ● 장은지 ...        │ 그룹 특성        │
│   ● 그룹평균          │ NS 55점 M       │
│                       │ HA 45점 M       │
└───────────────────────┴─────────────────┘
```
**→ 변경 없음**

### 3. 개인 리포트 화면 (★ 여기만 확장)
```
[기존]                          [1차 작업 후]
┌─────────────────┐            ┌─────────────────┐
│ 프로파일 요약    │            │ 프로파일 요약    │  ← 유지
│ (거미줄 차트)   │            │ (거미줄 차트)    │
├─────────────────┤            ├─────────────────┤
│ 척도별 점수표   │            │ ⚠️ 성숙도 경고   │  ← 추가
├─────────────────┤            ├─────────────────┤
│ 하위척도 차트   │            │ 기질 유형 분석   │  ← 추가
│                 │            │ (HML: 독립적인)  │
└─────────────────┘            ├─────────────────┤
                               │ 성격 유형 분석   │  ← 추가
                               │ (HHL: 조직화된)  │
                               ├─────────────────┤
                               │ 기질 상호작용    │  ← 추가
                               │ NS×HA, NS×RD... │
                               ├─────────────────┤
                               │ 척도별 점수표    │  ← 유지
                               ├─────────────────┤
                               │ 하위척도 차트    │  ← 유지
                               ├─────────────────┤
                               │ 코칭 가이드      │  ← 추가
                               └─────────────────┘
```

---

## 개인리포트 추가 섹션 상세

### 섹션 1: 성격 성숙도 경고 (조건부)

**표시 조건**: SD 백분위 < 30 AND/OR CO 백분위 < 30

```jsx
// 경고 레벨 판단
if (SDP < 30 && COP < 30) → severity: 'high' (빨강)
else if (SDP < 30 || COP < 30) → severity: 'moderate' (노랑)
else → 표시 안 함
```

**UI 예시**:
```
┌─────────────────────────────────────────────────┐
│ ⚠️ 성격 성숙도 주의                             │
│                                                 │
│ 자율성(SD)과 연대감(CO)의 백분위가 모두 30      │
│ 미만입니다. 적응상의 어려움이 예상되며,          │
│ 전문적인 상담이 권장됩니다.                      │
└─────────────────────────────────────────────────┘
스타일: bg-red-50 border-red-300 (high)
        bg-amber-50 border-amber-300 (moderate)
```

---

### 섹션 2: 기질 유형 분석

**유형 계산**: NS(T점수) × HA(T점수) × RD(T점수) → 3글자 코드
- T < 45: L (Low)
- 45 ≤ T ≤ 55: M (Medium)  
- T > 55: H (High)

**예시**: NS=62, HA=45, RD=38 → HML

**UI 예시**:
```
┌─────────────────────────────────────────────────┐
│ 🧬 기질 유형 분석                               │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │  HML   독립적인-자유주의적인                 │ │
│ └─────────────────────────────────────────────┘ │
│                                                 │
│ 진취적이고 순발력이 있으며, 자기 주장과 입장이   │
│ 분명한 독립적인 사람. 다른 사람의 평가보다는     │
│ 자신의 판단에 우선 순위를 두고 소신껏 행동한다.  │
│                                                 │
│ ┌──────────────────┐ ┌──────────────────┐      │
│ │ 💪 강점          │ │ 🔍 개발영역      │      │
│ │ 진취성, 순발력,  │ │ 자기중심적 인상, │      │
│ │ 소신, 독립성     │ │ 타인감정 이해... │      │
│ └──────────────────┘ └──────────────────┘      │
│                                                 │
│ ┌─────────────────────────────────────────────┐ │
│ │ 💡 코칭 포인트                              │ │
│ │ 독립성을 강점으로 인정하되, 중요한 관계에서 │ │
│ │ 상대방 관점 경청 연습                       │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

---

### 섹션 3: 성격 유형 분석

**유형 계산**: SD(T점수) × CO(T점수) × ST(T점수) → 3글자 코드

**UI**: 기질 유형과 동일한 레이아웃, 색상만 그린 계열

---

### 섹션 4: 기질 상호작용 해석

**3개 조합 분석**:
1. NS × HA (행동 활성화 vs 억제)
2. NS × RD (사회적 행동 양식)
3. HA × RD (대인관계 패턴)

**UI 예시**:
```
┌─────────────────────────────────────────────────┐
│ 🔗 기질 상호작용                                │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ 자극추구 × 위험회피  [HL] 충동-외향형        │ │
│ │ 충동적이고 외향적이며 공격적인 경향이 있다.  │ │
│ └─────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────┐ │
│ │ 자극추구 × 사회적민감성  [HL] 기회-피상형    │ │
│ │ 기회주의적이고 비관습적인 면이 있다...       │ │
│ └─────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────┐ │
│ │ 위험회피 × 사회적민감성  [ML] ...           │ │
│ │ ...                                         │ │
│ └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

---

### 섹션 5: 종합 코칭 가이드

기질유형과 성격유형의 코칭 포인트를 종합하여 표시

```
┌─────────────────────────────────────────────────┐
│ 📋 종합 코칭 가이드                             │
├─────────────────────────────────────────────────┤
│ 🎯 핵심 강점                                    │
│ • 진취성과 순발력                               │
│ • 논리적 사고와 효율성                          │
│                                                 │
│ 🌱 개발 제안                                    │
│ • 중요한 관계에서 상대방 관점 경청              │
│ • 창의적 접근과 유연성 개발                     │
│                                                 │
│ 💬 코칭 대화 예시                               │
│ "독립적으로 판단하시는 강점이 있으시네요.       │
│  혹시 중요한 결정에서 주변 의견을 들어보신      │
│  경험이 있으신가요?"                            │
└─────────────────────────────────────────────────┘
```

---

## 구현 순서

```
Step 1: 롤백
├── 현재 src 폴더 백업 (src_backup)
├── tci_app_phase1_final.jsx → src/App.jsx 복사
├── package.json에서 @supabase/supabase-js 제거
└── 동작 확인 (기존 Phase 1과 동일한지)

Step 2: 해석 데이터 추가
├── src/data/interpretations.js 생성
├── tci_interpretations.js 내용 복사
└── App.jsx에서 import 추가

Step 3: 유틸 함수 추가
├── getTScoreLevel() 함수
├── getTemperamentType() 함수
├── getCharacterType() 함수
└── checkMaturityWarning() 함수

Step 4: 개인리포트 섹션 추가
├── 성격 성숙도 경고 컴포넌트
├── 기질 유형 분석 컴포넌트
├── 성격 유형 분석 컴포넌트
├── 기질 상호작용 컴포넌트
└── 종합 코칭 가이드 컴포넌트

Step 5: 테스트
├── 그룹 목록 화면 정상 확인
├── 그룹 분석 화면 정상 확인 (기존과 동일)
├── 개인 리포트 새 섹션 표시 확인
└── PDF 다운로드 시 새 섹션 포함 확인
```

---

## 1차 작업 완료 기준

| 항목 | 확인 |
|------|------|
| 로그인 없이 바로 사용 가능 | ☐ |
| 그룹 생성/CSV 업로드 동작 | ☐ |
| 그룹 분석 화면 = Phase 1과 동일 | ☐ |
| 기질 탭: 레이더/막대/상세 정상 | ☐ |
| 성격 탭: 레이더/막대/상세 정상 | ☐ |
| 구성원 선택 토글 정상 | ☐ |
| 개인리포트: 성숙도 경고 표시 | ☐ |
| 개인리포트: 기질 유형 분석 표시 | ☐ |
| 개인리포트: 성격 유형 분석 표시 | ☐ |
| 개인리포트: 기질 상호작용 표시 | ☐ |
| LocalStorage 저장/복원 정상 | ☐ |

---

# 🔷 2차 작업: Supabase 연동

> ⚠️ **1차 작업 검증 완료 후 진행**

## 목표
UI 변경 없이 저장소를 LocalStorage → Supabase로 교체하고, 로그인 기능을 추가한다.

---

## 변경 범위

### 변경됨
| 항목 | Before | After |
|------|--------|-------|
| 데이터 저장 | localStorage | Supabase PostgreSQL |
| 인증 | 없음 | 이메일/비밀번호 로그인 |
| 접근성 | 단일 기기 | 다기기 |

### 변경 없음
| 항목 | 상태 |
|------|------|
| 그룹 분석 UI | 유지 |
| 개인 리포트 UI | 유지 |
| 차트 구성 | 유지 |
| 색상/스타일 | 유지 |

---

## 추가 파일 구조 (2차)

```
src/
├── App.jsx              # 인증 상태에 따른 분기 추가
├── main.jsx
├── index.css
├── lib/
│   └── supabase.js      # Supabase 클라이언트 (신규)
├── hooks/
│   └── useAuth.js       # 인증 훅 (신규)
├── components/
│   └── auth/
│       ├── LoginForm.jsx    # (신규)
│       └── SignUpForm.jsx   # (신규)
└── data/
    └── interpretations.js
```

---

## Supabase 연동 상세

### 데이터 저장 변경

**Before (LocalStorage)**:
```javascript
// 저장
localStorage.setItem('tci_groups', JSON.stringify(groups));

// 불러오기
const groups = JSON.parse(localStorage.getItem('tci_groups') || '[]');
```

**After (Supabase)**:
```javascript
// 저장
await supabase.from('groups').insert({ name, user_id: user.id });
await supabase.from('members').insert(members.map(m => ({ group_id, ...m })));

// 불러오기
const { data: groups } = await supabase
  .from('groups')
  .select('*, members(*)')
  .eq('user_id', user.id);
```

---

### 인증 흐름

```
┌─────────────────────────────────────────┐
│            앱 시작                       │
└─────────────────┬───────────────────────┘
                  ↓
         ┌───────────────┐
         │ 로그인 상태?   │
         └───────┬───────┘
                 │
    ┌────────────┴────────────┐
    ↓                         ↓
[로그인 안됨]              [로그인됨]
    │                         │
    ↓                         ↓
┌─────────────┐        ┌─────────────┐
│ 로그인 화면  │        │ 그룹 목록    │
│ [로그인]    │        │ (기존 UI)   │
│ [회원가입]  │        └─────────────┘
└─────────────┘
```

---

### 마이그레이션 (기존 사용자)

```javascript
// 최초 로그인 시 LocalStorage → Supabase 이전
const migrateData = async (userId) => {
  const localData = localStorage.getItem('tci_groups');
  if (!localData) return;
  
  const groups = JSON.parse(localData);
  for (const group of groups) {
    // Supabase에 저장
    const { data: newGroup } = await supabase
      .from('groups')
      .insert({ name: group.name, user_id: userId })
      .select()
      .single();
    
    // 멤버 저장
    await supabase.from('members').insert(
      group.members.map(m => ({ group_id: newGroup.id, ...m }))
    );
  }
  
  // 이전 완료 후 LocalStorage 정리
  localStorage.removeItem('tci_groups');
};
```

---

## 2차 작업 완료 기준

| 항목 | 확인 |
|------|------|
| 회원가입 동작 | ☐ |
| 로그인/로그아웃 동작 | ☐ |
| 그룹 데이터 Supabase 저장 | ☐ |
| 멤버 데이터 Supabase 저장 | ☐ |
| 다른 기기에서 동일 데이터 조회 | ☐ |
| LocalStorage → Supabase 마이그레이션 | ☐ |
| **UI = 1차 작업과 완전 동일** | ☐ |

---

# 📎 첨부 파일 목록

## 1차 작업용
| 파일명 | 용도 | 우선순위 |
|--------|------|----------|
| `tci_app_phase1_final.jsx` | App.jsx 복원 베이스 | ★★★ |
| `tci_interpretations.js` | 54개 유형 해석 데이터 | ★★★ |
| `tci_data_definitions.js` | 규준/라벨 데이터 | ★★☆ |

## 2차 작업용 (1차 완료 후)
| 파일명 | 용도 | 우선순위 |
|--------|------|----------|
| `supabase_schema.sql` | DB 테이블 생성 | ★★★ |

---

# 🚀 Claude Code 첫 메시지

## 1차 작업 시작 시:

```
현재 코드를 버리고 Phase 1으로 롤백합니다.

작업 순서:
1. src 폴더 백업 후 비우기
2. tci_app_phase1_final.jsx를 src/App.jsx로 복사
3. package.json에서 @supabase/supabase-js 제거
4. npm install 후 동작 확인
5. 개인리포트에만 해석 섹션 추가

절대 금지:
- Supabase 사용
- 로그인 기능
- 그룹 분석 UI 변경
- 파일 구조 복잡화

참고 파일:
- tci_app_phase1_final.jsx (복원할 원본)
- tci_interpretations.js (해석 데이터)
```

## 2차 작업 시작 시:

```
1차 작업이 검증 완료되었습니다.
이제 Supabase 연동을 진행합니다.

작업 순서:
1. Supabase 프로젝트 셋업
2. supabase_schema.sql 실행
3. lib/supabase.js 생성
4. useAuth 훅 구현
5. 로그인/회원가입 UI 추가
6. 데이터 저장 로직을 Supabase로 교체

핵심 규칙:
- UI는 1차 작업과 완전 동일하게 유지
- 저장소만 LocalStorage → Supabase로 변경

참고 파일:
- supabase_schema.sql (DB 스키마)
```

---

# ✅ 최종 체크리스트

## 1차 작업
- [ ] Phase 1 UI 100% 복원
- [ ] 개인리포트 해석 섹션 추가
- [ ] LocalStorage 정상 동작
- [ ] 배포 및 사용자 테스트

## 2차 작업
- [ ] Supabase 연동
- [ ] 로그인/회원가입 구현
- [ ] 마이그레이션 기능
- [ ] 다기기 테스트

---

**작성자**: Claude (Anthropic)  
**검토자**: 최박사  
**상태**: 1차 작업 대기 중
